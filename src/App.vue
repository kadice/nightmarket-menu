<template>
    <div class="scope-root relative min-h-screen flex md:justify-center items-start">
        <div style="display: none">
            <img src="/image/0.png">
            <img src="/image/1.png">
            <img src="/image/2.png">
            <img src="/image/3.png">
            <img src="/image/4.png">
            <img src="/image/5.png">
            <img src="/image/6.png">
            <img src="/image/7.png">
            <img src="/image/8.png">
            <img src="/image/9.png">
            <img src="/image/æ­£_0.png">
            <img src="/image/æ­£_1.png">
            <img src="/image/æ­£_2.png">
            <img src="/image/æ­£_3.png">
            <img src="/image/æ­£_4.png">
            <img src="/image/æ­£_5.png">
        </div>
        <!-- æ¨¡ç³ŠèƒŒæ™¯å±¤ -->
        <div v-if="printMode == false"
            class="image-bg fixed inset-0 -z-1 w-full min-h-screen bg-fixed bg-cover bg-center bg-[url('/image/bg-real.jpg')] blur-[4px] scale-110">
        </div>
        <!-- æˆªå®£å‚³åœ–ç”¨ -->
        <div v-else
            class="image-bg fixed inset-0 -z-1 w-full min-h-screen bg-fixed bg-contain bg-center bg-[url('/image/bg-real.jpg')] blur-[4px] scale-180">
        </div>

        <div class="min-w-[56rem] max-w-[56rem] min-h-screen bg-black/20 md:flex justify-center">

            <!-- MENU -->
            <div
                class="menu min-w-[28rem] max-w-[56rem] h-fit px-4 py-6 m-6 border-2 border-gray-400 font-bold bg-[var(--sheet-color)] text-[var(--ink-color)]">

                <!-- æ¨™é¡Œå€ -->
                <div class="grid gap-y-3 mb-1">
                    <div
                        class="title bg-[var(--ink-color)] text-[var(--sheet-color)] border-2 border-[var(--ink-color)] text-center py-1 text-[32px]">
                        å‡±ã€€å“¥ã€€ç‡’ã€€çƒ¤
                    </div>

                    <div class="info flex w-full px-1 pt-2">
                        <span class="flex-1">å°æœ¬ç¶“ç‡Ÿï¼Œåªæ”¶ç¾é‡‘</span>
                        <span class="relative text-right">
                            <img class="togo-img" src="/image/checked.png">
                            â–¡å¤–å¸¶ â–¡å…§ç”¨ æ¡Œè™Ÿï¼šï¼¿ï¼¿åˆè¨ˆï¼šï¼¿ï¼¿ï¼¿ï¼¿ï¼¿gil
                            <!-- ç¸½åƒ¹ -->
                            <div class="sum flex">
                                <img v-for="(src, index) in sumImgSrcList" :key="index" :src="src" />
                            </div>

                        </span>
                    </div>
                </div>

                <!-- å…§å®¹å€ -->
                <div class="grid gap-y-5">
                    <!-- åˆ†é¡BOX -->
                    <div v-for="(category, cIndex) in categories" :key="cIndex"
                        class="bg-[var(--sheet-color)] border-4 border-[var(--ink-color)]">

                        <!-- åˆ†é¡åç¨± -->
                        <div class="bg-[var(--ink-color)] text-[var(--sheet-color)] text-[22px] px-1">
                            {{ category.name }}
                        </div>
                        <!-- å“é …BOX -->
                        <div class="divide-y divide-[var(--ink-color)]">
                            <div v-for="(item, index) in category.items" :key="index"
                                class="grid grid-cols-8 items-center divide-x-4 divide-[var(--ink-color)]">

                                <!-- å“é …è³‡è¨Š -->
                                <div class="col-span-6 h-full flex flex-col justify-center px-1 pt-1">
                                    <div>
                                        <span class="pr-1">{{ item.name }}</span>
                                        <span class="text-sm text-[var(--name2-text-color)]">{{ item.name2 }}</span>
                                    </div>
                                    <div class="msg text-[var(--msg-text-color)]">{{ item.msg }}</div>
                                </div>

                                <!-- åƒ¹æ ¼ -->
                                <div class="price col-span-1 h-full flex items-center justify-end px-1 pt-1">
                                    {{ item.price }}</div>

                                <!-- æ•¸é‡-->
                                <div class="col-span-1 h-full flex items-center justify-center relative">
                                    <button v-if="printMode == false" @click="decrease(cIndex, index)"
                                        class="text-gray-400 z-10">ï¼</button>

                                    <div class="flex-1">
                                        <img :src="countImgSrc(item.count)"
                                            class="absolute -top-1 left-1 w-[50px] h-[55px] z-0" />
                                    </div>

                                    <button v-if="printMode == false" @click="increase(cIndex, index)"
                                        class="text-gray-400 z-10">ï¼‹</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è³‡è¨Šå€ -->
                <div class="info -mb-2 px-2 pt-1">
                    <div>è«‹å¡«å¦¥èœå–®å¾Œäº¤çµ¦è€é—†ï¼Œç¾é»ç¾åšè«‹è€å¿ƒç­‰å€™ï¼Œæ„Ÿè¬ï¼</div>
                    <div>åº—å€ï¼šå…ƒç´ æœæé¢¨å€ ä¼Šä¿®åŠ å¾·å±…ä½å€æ“´å¼µè¡—10-56è™Ÿ1F æ”¤ä½09</div>
                </div>
            </div>

            <!-- å·¥å…·ç®± -->
            <div class="p-4" v-if="printMode == false">
                <div class="bg-yellow-50 border-4 border-[#bd4747] rounded-lg shadow-2xl flex flex-col gap-2 p-4 m-2">
                    <!-- å…¬å‘Š -->
                    <div
                        class="notice w-full h-40 p-2 bg-white text-black font-semibold rounded-lg shadow-inner border border-gray-300 overflow-y-auto whitespace-pre-wrap leading-relaxed text-[18px] divide-y divide-gray-300">

                        <div>ğŸ”¥å‡±å“¥ç‡’çƒ¤ğŸ”¥å°‡æ–¼6/21å¿«é–ƒç™»å ´ï¼æ•¬è«‹æœŸå¾…</div>
                        <div><span>06/01 16:14</span>æ˜¯çœŸçš„æ²’æœ‰è‡­è±†è…ï¼Œä¸è¦å†å•äº†</div>
                        <div><span>06/01 08:30</span>å–®ä¸€å“é …é™è³¼äº”ä»½ï¼Œåƒé€™éº¼å¤šä½ æ˜¯æƒ³å¹¹å˜›ï¼Ÿ</div>
                        <div></div>

                    </div>

                    <!-- é€å–®æŒ‰éˆ• -->
                    <button @click="showModal = true"
                        class="bg-[#bd4747] text-white font-bold py-2 px-3 rounded hover:bg-red-700 transition-all duration-150">
                        é€™æ˜¯ä¸€é¡†ç¥å¥‡çš„æŒ‰éˆ•ï¼Œå’»å’»å’»ï½
                    </button>
                </div>
            </div>
        </div>

        <!-- å½ˆå‡ºè¦–çª— -->
        <div v-if="showModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
            <div
                class="bg-yellow-50 border-4 border-[#bd4747] rounded-lg shadow-2xl p-4 min-w-[300px] min-h-[200px] max-w-[90%]">

                <!-- å…§å®¹å€ -->
                <div
                    class="border-2 border-dashed border-[#bd4747] p-4 text-black font-semibold whitespace-pre-wrap min-h-[100px]">
                    {{ orderText }}
                </div>

                <!-- æŒ‰éˆ•å€ -->
                <div class="mt-4 flex justify-between items-center space-x-2">
                    <button @click="copyOrderText"
                        class="flex-1 bg-[#bd4747] text-white font-bold py-2 rounded hover:bg-red-700 transition-all duration-150">
                        è¤‡è£½æ–‡å­—
                    </button>
                    <button @click="showModal = false"
                        class="flex-1 bg-gray-700 text-white font-bold py-2 rounded hover:bg-gray-700 transition-all duration-150">
                        é—œé–‰
                    </button>
                    <!-- <button @click="refreshOrderText"
                        class="bg-yellow-400 text-black font-bold py-2 px-3 rounded hover:bg-yellow-300 transition-all duration-150">
                        â†»
                    </button> -->
                </div>
            </div>
        </div>



    </div>


</template>

<script setup>
import { ref, reactive, computed } from 'vue'
const categories = reactive([
    {
        name: 'ç‚­ç‡’ä¸²çƒ¤ grill',
        items: [
            { short: 'ç‰›ä¸²', name: 'è¶…å¤šæ±ç‰›è‚‰çƒ¤ä¸²', name2: 'beef', price: 1500, msg: 'åš´é¸æ‹‰æœ­ç½•ç‰›ï¼Œé€™ç‰›çš„è‚‰æ¯”å…‰æˆ°é‚„ç·Šå¯¦ï¼Œçƒ¤äº†ä¹Ÿæ¯”å…‰æˆ°é¦™', count: 0 },
            { short: 'é³¥ä¸²', name: 'DoDoé³¥è…¿è‚‰çƒ¤ä¸²', name2: 'dodo', price: 1500, msg: 'æ¸¡æ¸¡é³¥ç•Œæ»¿ç´šç²¾é¸å¤§è…¿è‚‰ï¼Œå¥½åƒç¨‹åº¦ä¸è¼¸ä½ å®¶é™¸è¡Œé³¥', count: 0 },
            { short: 'é­šä¸²', name: 'çˆ†çˆ†é­šä¸²', name2: 'fish', price: 2500, msg: 'æµ·è³Šçœ¾èªªåƒé€™é­šå¯ä»¥åŠ ç›´çˆ†ï¼Œä¸ç®¡ä½ ä¿¡ä¸ä¿¡åæ­£æˆ‘æ˜¯ä¿¡äº†', count: 0 },
            { short: 'æ™‚è”¬', name: 'å¥åº·çƒ¤æ™‚è”¬', name2: 'vegetable', price: 1500, msg: 'è”¬èœçš„ä½¿å‘½å°±æ˜¯å¹«ä½ å°‘ä¸€é»ç½ªæƒ¡æ„Ÿï¼Œçƒ¤äº†æ›´åƒåœ¨åšå¥åº·é¸æ“‡', count: 0 },
            { short: 'çƒ¤é¦™è…¸', name: 'çƒ¤é¦™è…¸', name2: 'sausage', price: 1500, msg: 'å°é¢æ¾¤ä¸­çš„å­¸ç”Ÿæ”¾å­¸éƒ½æœƒä¾†è²·ï¼Œäººæ‰‹ä¸€æ”¯ï¼Œä¸€å£çˆ†æ±ï¼', count: 0 },
            //{ short: 'é¦™è…¸', name: 'é¦™è…¸æ³¡èœ', name2: 'sausage & pickled cabbage', price: 1000, msg: 'æ³¡èœæ‰æ˜¯éˆé­‚ï¼Œé¦™è…¸åªæ˜¯è¼‰å…·ï¼Œä¸æ¥å—å–®é»é¦™è…¸', count: 0 },
            { short: 'ç„—è¦', name: 'ç„—çƒ¤é®®è¦', name2: 'shrimp', price: 1500, msg: 'æ­é…ç‰¹è£½é†¬æ±ä¾†é£Ÿç”¨ï¼Œå‘³é“æ›´æ˜¯å¦™ä¸å¯è¨€', count: 0 },
            { short: 'æµ·èº', name: 'çƒ¤æµ·èº', name2: 'snail', price: 3000, msg: 'è€é—†ç‚ºé€™é¡†èºè·‘äº†å››å€‹å¸‚å ´ï¼Œè«‹å°Šé‡ç‰ çš„æ—…ç¨‹å’Œåƒ¹æ ¼', count: 0 },
        ],
    },
    {
        name: 'ç²¾é¸ç‚¸ç‰© fried',
        items: [
            { short: 'è±†è…', name: 'ä¸æ˜¯è‡­è±†è…', name2: 'tofu', price: 1500, msg: 'ä¹‹å‰æœ‰å®¢äººæŠ±æ€¨èŸ¹è‚‰é¤…è®Šæˆè‡­èŸ¹è‚‰é¤…ï¼Œåªå¥½æ”¹è³£ç‚¸è±†è…', count: 0 },
            { short: 'èŠ±æ', name: 'ç‚¸ä¸€å †èŠ±æåœˆ', name2: 'squid', price: 2000, msg: 'æˆ‘è³£èŠ±æåœˆçš„åŸå‰‡å°±æ˜¯å¹¹ä½ å¨˜å¡çˆ†ï¼(å”®å®Œç‚ºæ­¢)', count: 0 },
            { short: 'èŸ¹é¤…', name: 'ç‚¸èŸ¹è‚‰é¤…', name2: 'crab cake', price: 1500, msg: 'è£½ä½œéç¨‹ä¸­æ²’æœ‰çœŸæ­£èƒèŸ¹å—å‚·ï¼Œåªæœ‰è€é—†ç‡™å‚·', count: 0 },
            { short: 'ç‚¸é­š', name: 'é…¥ç‚¸é®®é­šå¡Š', name2: 'fish', price: 1500, msg: 'å¤–è¡¨é‡‘é…¥è„†ï¼Œå…§åº•è¶…Juicyï¼Œä¹ä½ å‘·å˜ã„Ÿå½ˆèˆŒ', count: 0 },
        ],
    },
    {
        name: 'é£²å“ drink',
        items: [
            { short: 'ç´…èŒ¶', name: 'ç´…èŒ¶', name2: 'black tea', price: 1000, msg: 'çƒçˆ¾é”å“ˆç´…èŒ¶ï¼Œè§£è†©å¥½é¸æ“‡ï¼Œè§£å®Œè¨˜å¾—å†å¤šåƒå…©ä¸²', count: 0 },
            { short: 'å¥¶èŒ¶', name: 'å¥¶èŒ¶', name2: 'milk tea', price: 1200, msg: 'æ—©é¤åº—å¥¶èŒ¶ï¼Œæ²’æœ‰è³£é®®å¥¶èŒ¶ï¼Œå› ç‚ºè€é—†å–œæ­¡æ—©é¤åº—å¥¶èŒ¶', count: 0 },
            { short: 'è±†æ¼¿', name: 'è±†æ¼¿', name2: 'soy milk', price: 1500, msg: 'æœ‰å®¢äººå•æ€éº¼æ²’æœ‰ç´…èŒ¶è±†æ¼¿ï¼Œå•Šä½ å°±å„è²·ä¸€æ¯è‡ªå·±åŠ ', count: 0 },
            { short: 'éº¥ä»”èŒ¶', name: 'éº¥ä»”èŒ¶', name2: 'barley tea', price: 1000, msg: 'â—‹â—‹å‘³éº¥ä»”ï½èŒ¶ï½(å”±)(è€é—†æ²’æ¥æ¥­é…ï¼Œä½†æ­¡è¿æ´½è«‡)', count: 0 },
            { short: 'æŸ³ä¸æ±', name: 'æŸ³ä¸æ±', name2: 'orange juice', price: 1200, msg: 'ç´”æ‰‹å·¥ç¾æ¦¨ï¼ŒæŸ³ä¸æœ¬äººä¹Ÿä¸ç¢ºå®šç‚ºä»€éº¼è¦é€™éº¼ç´¯', count: 0 },
        ],
    },
]);

const printMode = ref(false)

// è®“ä½ èƒ½åœ¨ç€è¦½å™¨ console è£¡ç”¨ window.toggleDebug() åˆ‡æ›å®ƒ
window.togglePrintMode = () => {
    printMode.value = !printMode.value
    console.log('printMode:', printMode.value)
}

// categories[0].items[0].count = 1
// categories[0].items[1].count = 2
// categories[0].items[2].count = 3
// categories[0].items[3].count = 4
// categories[0].items[4].count = 5

const increase = (cIndex, iIndex) => {
    if (categories[cIndex].items[iIndex].count < 5) {
        categories[cIndex].items[iIndex].count++;
    }
};

const decrease = (cIndex, iIndex) => {
    if (categories[cIndex].items[iIndex].count > 0) {
        categories[cIndex].items[iIndex].count--;
    }
};

const getSum = computed(() => {
    //return 11000
    let sum = 0;
    for (const cate of categories) {
        for (const item of cate.items) {
            sum += item.price * item.count
        }
    }
    return sum
})

const countImgSrc = (count) => {
    if (count < 0 || count > 5) return '';
    return `${import.meta.env.BASE_URL}image/æ­£_${count}.png`;
};

const sumImgSrcList = computed(() =>
    getSum.value > 0 ? getSum.value.toString().split('').map(d => `${import.meta.env.BASE_URL}image/${Number(d)}.png`) : []
);

const showModal = ref(false)

const orderText = computed(() => {
    const result = categories.flatMap(cate =>
        cate.items
            .filter(item => item.count > 0)
            .map(item => `${item.short}${item.count}` + ((cate.name == 'é£²å“ drink') ? 'æ¯' : 'ä»½'))
    ).join('ã€')
    return (result == '') ? "ä½ é‚„æ²’é»é¤ï¼Œè€é—†æ„Ÿåˆ°å¾ˆåˆ‡å¿ƒ...T_T" : result
})

const copyOrderText = () => {
    navigator.clipboard.writeText(orderText.value)
}

</script>

<style scoped>
.notice > div > span {
    color: #777;
    font-size: 14px;
    padding-right: 4px;
    display: block;
    margin-bottom: -7px;
}

.scope-root {
    --sheet-color: #ffdfdf;
    --ink-color: #302726;
    --name2-text-color: #555;
    --msg-text-color: #777;
}

.image-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.2);
}

.menu {
    font-family: 'æ–°ç´°æ˜é«”';
    font-size: 16px;
    box-shadow: 5px 10px 20px #333, -2px -1px 5px #333;
}

.title {
    font-family: 'æ¨™æ¥·é«”';
}

.info {
    font-family: 'æ¨™æ¥·é«”';
}

.price {
    font-family: 'sans-serif';
}

.msg {
    font-size: 13px;
}

.togo-img {
    position: absolute;
    bottom: -3px;
    left: -7px;
    width: 50px;
    height: 50px;
    object-fit: cover;
    z-index: 1;
    overflow: visible;
    transform: rotate(10deg);
}

.sum {
    position: absolute;
    bottom: -5px;
    right: 0px;
    transform: rotate(-10deg);
}

.sum img {
    transform: rotate(10deg);
    height: 50px;
}

button {
    cursor: pointer;
}
</style>
